services:
  - docker

before_install:
  - docker pull flamusdiu/archlinux-devel

script:
  - docker run -v $(pwd):/build -w /build flamusdiu/archlinux-devel /bin/bash -c "sudo pacman -Syu grub --noconfirm && bash build.sh"
before_deploy:
  - export FILE_TO_UPLOAD="$(pwd)/out/bootia32.efi"

deploy:
  provider: releases
  api_key: $OAUTH_KEY
  file: $FILE_TO_UPLOAD
  skip_cleanup: true
  on:
    tags: true
